<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Tectonic WASM LaTeX → PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{margin:0;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0b1220;color:#e6f0ff}
  header{display:flex;gap:10px;align-items:center;padding:12px 14px;background:#0f172a;border-bottom:1px solid #1e293b}
  header h1{margin:0;font-size:16px}
  .sp{flex:1}
  .btn{border:1px solid #1e293b;background:transparent;color:#e6f0ff;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:#0A66C2;border-color:#0A66C2}
  .grid{display:grid;grid-template-columns:minmax(320px,1fr) minmax(420px,1fr);gap:14px;padding:14px;height:calc(100% - 54px)}
  .card{border:1px solid #1e293b;background:#0f172a;border-radius:16px;display:flex;flex-direction:column;min-height:0;overflow:hidden}
  .card h2{margin:0;padding:10px 12px;font-size:13px;color:#9fb5d1;text-transform:uppercase;border-bottom:1px solid #1e293b}
  textarea{flex:1;padding:12px;border:0;outline:none;background:transparent;color:#e6f0ff;font:13px/1.35 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .bar{display:flex;gap:8px;padding:10px;border-top:1px solid #1e293b}
  .status{margin-left:auto;color:#9fb5d1}
  iframe{width:100%;height:100%;border:0;background:#fff}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
</style>
<!-- Tectonic WASM runtime -->
<script type="module">
  import init, { Tectonic } from "https://cdn.jsdelivr.net/npm/@tectonic-exec/wasm@0.1.2/dist/tectonic.min.js";

  // Simple UI refs
  const ready = init();
  window.__tectonicReady = ready;
</script>
</head>
<body>
<header>
  <h1>LaTeX → PDF (Tectonic WASM)</h1><div class="sp"></div>
  <button id="compile" class="btn primary">Compile to PDF</button>
  <button id="download-tex" class="btn">Download .tex</button>
</header>

<div class="grid">
  <section class="card">
    <h2>Source (.tex)</h2>
    <textarea id="src"></textarea>
    <div class="bar"><span class="status" id="status">loading engine…</span></div>
  </section>
  <section class="card">
    <h2>PDF</h2>
    <iframe id="pdf"></iframe>
    <div class="bar" id="log" style="white-space:pre-wrap;font-family:ui-monospace,monospace;color:#cbd5e1"></div>
  </section>
</div>

<script type="module">
  import init, { Tectonic } from "https://cdn.jsdelivr.net/npm/@tectonic-exec/wasm@0.1.2/dist/tectonic.min.js";

  const srcEl = document.getElementById('src');
  const status = document.getElementById('status');
  const logEl = document.getElementById('log');
  const pdfFrame = document.getElementById('pdf');
  const btn = document.getElementById('compile');
  const btnTex = document.getElementById('download-tex');

  const KEY = 'tectonic_resume_src_v1';
  const SAMPLE = `% Your LaTeX here
\\documentclass[10.5pt,a4paper]{article}
\\usepackage[utf8]{inputenc}
\\usepackage[T1]{fontenc}
\\usepackage[margin=1in,top=0.33in,bottom=0.33in]{geometry}
\\usepackage{helvet}
\\renewcommand{\\familydefault}{\\sfdefault}
\\usepackage{microtype}
\\usepackage{enumitem}
\\usepackage{xcolor}
\\usepackage[hidelinks]{hyperref}
\\usepackage{tabularx}
\\usepackage{array}
% ... rest of your resume ...
\\begin{document}
Hello, Tectonic!
\\end{document}`;

  srcEl.value = localStorage.getItem(KEY) || SAMPLE;

  const tt = new Tectonic({
    // A default web bundle with LaTeX resources; you can swap for a different bundle mirror
    bundle: "https://data.jsdelivr.com/v1/package/npm/@tectonic-exec/bundle-default/latest",
  });

  async function compile() {
    status.textContent = 'compiling…'; logEl.textContent = '';
    const tex = srcEl.value;
    localStorage.setItem(KEY, tex);

    // Feed a virtual file to Tectonic and compile to PDF
    const name = "main.tex";
    tt.setFile(name, new TextEncoder().encode(tex));

    try {
      const result = await tt.compile(name);      // returns a Uint8Array (PDF bytes)
      const blob = new Blob([result], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);
      pdfFrame.src = url;
      status.textContent = 'compiled ✓';
    } catch (e) {
      status.textContent = 'error';
      logEl.textContent = (e && e.message) ? e.message : String(e);
      console.error(e);
    }
  }

  document.getElementById('compile').onclick = compile;
  document.getElementById('download-tex').onclick = () => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([srcEl.value], {type:'text/x-tex'}));
    a.download = 'document.tex'; a.click();
  };

  status.textContent = 'ready';
</script>
</body>
</html>
